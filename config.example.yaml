# DC-Detector v0.2 — Configuration
# Copy this file to config.yaml and adjust for your environment.

# ---------------------------------------------------------------------------
# Video capture
# ---------------------------------------------------------------------------
capture:
  # Source: "auto" (rpicam → CSI → USB fallback), "rpicam", "csi", "usb", "file"
  #   rpicam — Picamera2 (Raspberry Pi 5 / Bookworm, recommended for CSI cameras)
  #   csi    — OpenCV V4L2 backend (legacy)
  #   auto   — tries rpicam first (Linux only), then csi, then usb
  source: "auto"
  # Path to video file (used when source: "file" or playback mode)
  video_file: ""
  # Camera device index (0 = first camera)
  device_index: 0
  # Capture resolution & FPS
  width: 1280
  height: 720
  fps: 30
  # Port for the MJPEG / API server
  port: 8001
  # Recording settings
  recording:
    enabled: true
    directory: "./data/recordings"
    # Codec: "MJPG" (most compatible) or "XVID"
    codec: "MJPG"

# ---------------------------------------------------------------------------
# Object detection
# ---------------------------------------------------------------------------
detection:
  # YOLO model path (.pt, .onnx, or NCNN directory)
  # If an *_ncnn_model directory exists next to the .pt file, it is used automatically
  model_path: "./models/yolo11n.pt"
  # Confidence threshold
  confidence: 0.5
  # Input image size for YOLO (smaller = faster, larger = more accurate)
  #   320 → ~25-30 FPS on Pi 5 (NCNN)
  #   640 → ~10-15 FPS on Pi 5 (NCNN)
  imgsz: 320
  # URL of the capture MJPEG stream (filled automatically by launcher)
  stream_url: "http://localhost:8001/stream"
  # Port for detection API
  port: 8002
  # Where to store detection results (CSV/JSON, JPEG, GIF)
  results_dir: "./data/detections"
  # GIF duration in seconds
  gif_duration: 5
  # Results file format: "json" or "csv"
  results_format: "json"
  # Tracker: "bytetrack" or "botsort"
  tracker: "bytetrack"

# ---------------------------------------------------------------------------
# MAVLink (flight controller over UART)
# ---------------------------------------------------------------------------
mavlink:
  enabled: true
  # Device: /dev/ttyAMA1 on Pi (UART1, GPIO0 TX / GPIO1 RX), COM3 on Windows
  # Requires: dtoverlay=uart1-pi5 in /boot/firmware/config.txt
  device: "/dev/ttyAMA1"
  baudrate: 57600
  # Port for MAVLink REST / WebSocket API
  port: 8003

# ---------------------------------------------------------------------------
# LoRa / ESP32 (GPIO UART)
# ---------------------------------------------------------------------------
lora:
  enabled: true
  # Device: /dev/ttyAMA0 on Pi (UART0, GPIO14/15), COM4 on Windows
  # Requires: dtparam=uart0=on in /boot/firmware/config.txt (Pi 5: BT uses separate UART)
  device: "/dev/ttyAMA0"
  baudrate: 115200
  # Port for LoRa REST / WebSocket API
  port: 8004
  # Forward MAVLink telemetry to ESP32 via serial (TEL: messages)
  telemetry_forward: true
  # Interval in seconds between telemetry pushes
  telemetry_interval: 2.0
  # Detection forward interval in seconds
  detection_interval: 3.0
  # Status forward interval in seconds
  status_interval: 5.0
  # Auto-connect Raspberry Pi to ESP32 WiFi AP (Linux only, uses nmcli)
  # SSID and password are received from ESP32 via UART automatically
  esp_wifi:
    enabled: true
    # mDNS hostname — Pi dashboard accessible at http://<hostname>.local:8080
    hostname: "dc-detect"

# ---------------------------------------------------------------------------
# Web server (main UI entry point)
# ---------------------------------------------------------------------------
web:
  port: 8080

# ---------------------------------------------------------------------------
# Servo / Gimbal (PWM GPIO pins — Raspberry Pi only)
# ---------------------------------------------------------------------------
servo:
  servo1_pin: 18    # GPIO18 — Pin 12
  servo2_pin: 12    # GPIO12 — Pin 32
  min_angle: 0
  max_angle: 180

# ---------------------------------------------------------------------------
# Wi-Fi Access Point (Raspberry Pi only, used by setup_ap.sh)
# ---------------------------------------------------------------------------
ap:
  ssid: "DC-Detector"
  password: "dcdetector"
  channel: 6
  ip: "192.168.4.1"

# ---------------------------------------------------------------------------
# Logging
# ---------------------------------------------------------------------------
logging:
  level: "INFO"
  directory: "./logs"
  # Max size per log file in bytes (10 MB)
  max_bytes: 10485760
  # Number of rotated backups to keep
  backup_count: 5
